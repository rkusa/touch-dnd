!function(c){function n(a,d,b){m("transform",a,"translate("+d+"px, "+b+"px)")}function m(a,d,b){a=a.toLowerCase();var c=a.charAt(0).toUpperCase()+a.substr(1);a=["webkit","Moz","ms","O"].map(function(a){return a+c}).concat("transform");for(var h=0,e=a.length;h<e;++h)if(a[h]in d.style){if(void 0!==b)d.style[a[h]]=b;else return d.style[a[h]];break}}function p(a,d,b){return function(e,h,f){var k=[];this.each(function(){var g=c(this).data(d);if("string"===typeof e){if("undefined"===typeof g)throw Error(d+
" not defined");switch(e){case "enable":g.enable();break;case "disable":g.disable();break;case "destroy":g.destroy();c(this).removeData(d);break;case "option":void 0!==f?g.opts[h]=f:"object"===typeof h?g.opts=c.extend(g.opts,h):h?k.push(g.opts[h]):k.push(g.opts);break;case "toArray":if("sortable"!==d)break;k.push(g.toArray(h))}}else{if(g)return c.extend(g.opts,e),this;g=new a(c(this),c.extend({},b,e));g.create();c(this).data(d,g)}});return k.length?1===k.length?k[0]:k:this}}var q=0,e=function(){this.eventHandler=
c("<div />");this.parent=this.el=null;this.origin={x:0,y:0,transition:null,translate:null,offset:{x:0,y:0}};var a;Object.defineProperty(this,"placeholder",{get:function(){return a},set:function(d){a!==d&&(a&&a.remove(),a=d)}})};e.prototype.on=function(){this.eventHandler.on.apply(this.eventHandler,Array.prototype.slice.call(arguments));return this};e.prototype.off=function(){this.eventHandler.off.apply(this.eventHandler,Array.prototype.slice.call(arguments));return this};e.prototype.start=function(a,
d,b){this.parent=a;this.el=d;this.origin.x=b.pageX;this.origin.y=b.pageY;this.origin.transform=m("transform",this.el[0]);this.origin.transition=m("transition",this.el[0]);a=this.el[0].getBoundingClientRect();this.origin.offset.x=a.left-this.origin.x;this.origin.offset.y=a.top-this.origin.y;this.el[0].style.pointerEvents="none";c(document).on("mousemove touchmove MSPointerMove pointermove",c.proxy(this.move,this));m("transition",this.el[0],"");this.eventHandler.trigger("dragging:start");return this.el};
e.prototype.stop=function(a){if(this.last){var d=this.last;this.last=null;c(d).trigger("dragging:drop")}this.el&&(void 0===a&&(a=!0),a&&(m("transition",this.el[0],"all 0.5s ease-in-out 0s"),setTimeout(m.bind(null,"transition",this.el[0],this.origin.transition),500)),m("transform",this.el[0],this.origin.transform||"translate(0, 0)"),this.el[0].style.pointerEvents="auto",c(document).off("mousemove touchmove MSPointerMove pointermove",this.move),this.parent=this.el=this.placeholder=null,this.eventHandler.trigger("dragging:stop"))};
e.prototype.move=function(a){if(this.el){var d=a.clientX||event.touches[0].clientX,b=a.clientY||event.touches[0].clientY,e=document.elementFromPoint(d,b);e!==this.last&&(c(e).trigger("dragging:enter",d,b),c(this.last).trigger("dragging:leave",d,b));this.last=e;n(this.el[0],a.pageX-this.origin.x,a.pageY-this.origin.y)}};var b=c.dragging=parent.$.dragging||new e,s=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,r=function(a,d,b,e){function h(a,b){Array.prototype.slice.call(a).forEach(function(a){k&&
f.target[0]!==c(a).parent()[0]||(c(a).is(g)&&b.call(a),k||c(d,a).each(function(){b.call(this)}))})}var f=this;this.target=a;var k=">"===d[0],g=k?d.substr(1):d;this.observer=new s(function(a){f.disconnect();a.forEach(function(a){b&&h(a.addedNodes,b);e&&h(a.removedNodes,e)});f.observe()});c(d,a).each(function(){b.call(this)});this.observe()};r.prototype.disconnect=function(){this.observer.disconnect()};r.prototype.observe=function(){this.observer.observe(this.target[0],{childList:!0,subtree:!0})};e=
function(a,b){this.id=q++;this.el=c(a);this.opts=b;this.cancel=!1!==b.handle;this.connectedWith=[];this.opts.connectWith&&this.connectWith(this.opts.connectWith)};e.prototype.connectWith=function(a){var b=this,e=c(a),f=window;e[0].ownerDocument!==document&&(f=e[0].ownerDocument.defaultView);f.$(a).each(function(){var a=f.$(this);if(a[0]!==b.el[0]){var c=a.data("sortable")||a.data("droppable");if(c)c.connectedWith.push(b.id);else a.one("sortable:create droppable:create",function(a,c){c.connectedWith.push(b.id)})}})};
e.prototype.create=function(){this.el.on("mousedown touchstart MSPointerDown pointerdown",c.proxy(this.start,this));var a=this;setTimeout(function(){a.el.trigger("draggable:create",a)})};e.prototype.destroy=function(){this.el.off("mousedown touchstart MSPointerDown pointerdown",this.start)};e.prototype.enable=function(){this.opts.disabled=!1};e.prototype.disable=function(){this.opts.disabled=!0};e.prototype.start=function(a){if(this.opts.disabled)return!1;a=a.originalEvent||a;a.preventDefault();if(this.opts.cancel)for(var d=
c(a.target);d[0]!==this.el[0];){if(d.is(this.opts.cancel))return!1;d=d.parent()}if(this.opts.handle){for(var d=c(a.target),e=!1;d[0]!==this.el[0];){if(d.is(this.opts.handle)){e=!0;break}d=d.parent()}if(!e)return!1}b.start(this,this.el,a);c(document).on("mouseup touchend MSPointerUp pointerup",c.proxy(this.end,this))};e.prototype.end=function(a){c(document).off("mouseup touchend MSPointerUp pointerup",this.end);b.stop()};var l=function(a,b){this.id=q++;this.el=c(a);this.opts=b;this.accept=!1;this.connectedWith=
[]};l.prototype.create=function(){this.el.on("dragging:enter",c.proxy(this.enter,this)).on("dragging:leave",c.proxy(this.leave,this)).on("dragging:drop",c.proxy(this.drop,this));b.on("dragging:start",c.proxy(this.activate,this)).on("dragging:stop",c.proxy(this.reset,this));var a=this;setTimeout(function(){a.el.trigger("droppable:create",a)})};l.prototype.destroy=function(){this.el.off("dragging:enter",this.enter).off("dragging:leave",this.leave).off("dragging:drop",this.drop)};l.prototype.enable=
function(){this.opts.disabled=!1};l.prototype.disable=function(){this.opts.disabled=!0};l.prototype.activate=function(a){this.accept=-1!==this.connectedWith.indexOf(b.parent.id);this.accept||(a="*"===this.opts.accept||("function"===typeof this.opts.accept?this.opts.accept.call(this.el[0],b.el):b.el.is(this.opts.accept)),"default"!==this.opts.scope?(this.accept=b.parent.opts.scope===this.opts.scope,this.accept||"*"===this.opts.accept||(this.accept=a)):this.accept=a);this.accept&&(this.opts.activeClass&&
this.el.addClass(this.opts.activeClass),this.el.trigger("droppable:activate",b.el))};l.prototype.reset=function(a){this.accept&&(this.opts.activeClass&&this.el.removeClass(this.opts.activeClass),this.opts.hoverClass&&this.el.removeClass(this.opts.hoverClass),this.el.trigger("droppable:deactivate",b.el))};l.prototype.enter=function(a){if(this.opts.disabled)return!1;a.stopPropagation();b.placeholder&&b.placeholder.hide();this.accept&&this.opts.hoverClass&&this.el.addClass(this.opts.hoverClass)};l.prototype.leave=
function(a){if(this.opts.disabled)return!1;this.opts.hoverClass&&this.accept&&this.el.removeClass(this.opts.hoverClass)};l.prototype.drop=function(a){if(this.opts.disabled||!this.accept)return!1;a.stopPropagation();b.el&&(a=b.el,b.stop(!1),c(this.el).append(a.clone()),this.el.trigger("droppable:receive",{item:a}))};var f=function(a,b){this.id=q++;this.el=a;this.opts=b;var e;try{e=this.el.find(this.opts.items)[0].tagName}catch(f){e=/^ul|ol$/i.test(this.el.tagName)?"li":"div"}this.placeholder=c("<"+
e+' class="'+this.opts.placeholder+'" />');this.lastX=this.lastY=this.direction=this.accept=this.index=this.lastEntered=null;this.connectedWith=[];this.opts.connectWith&&this.connectWith(this.opts.connectWith)};f.prototype.connectWith=e.prototype.connectWith;f.prototype.create=function(){this.el.on("mousedown touchstart MSPointerDown pointerdown",this.opts.items,c.proxy(this.start,this)).on("dragging:enter",this.opts.items,c.proxy(this.enter,this)).on("dragging:drop",this.opts.items,c.proxy(this.drop,
this));this.el.on("dragging:enter",c.proxy(this.enter,this)).on("dragging:drop",c.proxy(this.drop,this));b.on("dragging:start",c.proxy(this.activate,this)).on("dragging:stop",c.proxy(this.reset,this));var a=this;setTimeout(function(){a.el.trigger("sortable:create",a)});this.observer=new r(this.el,this.opts.items,function(){},function(){var b=c(this);a.el.trigger("sortable:sort",{item:b});a.el.trigger("sortable:update",{item:b,index:-1});a.el.trigger("sortable:change",{item:b})})};f.prototype.destroy=
function(){this.el.off("mousedown touchstart MSPointerDown pointerdown",this.opts.items,this.start).off("dragging:enter",this.opts.items,this.enter).off("dragging:drop",this.opts.items,this.drop);this.el.off("dragging:enter",this.enter).off("dragging:drop",this.drop);this.observer.disconnect()};f.prototype.enable=function(){this.opts.disabled=!1};f.prototype.disable=function(){this.opts.disabled=!0};f.prototype.activate=function(a){this.accept=b.parent.id===this.id||!!~this.connectedWith.indexOf(b.parent.id);
this.isEmpty=0===this.el.find(this.opts.items).length;this.accept&&(this.accept=b.parent.id===this.id||"*"===this.opts.accept||("function"===typeof this.opts.accept?this.opts.accept.call(this.el[0],b.el):b.el.is(this.opts.accept)))&&(this.opts.activeClass&&this.el.addClass(this.opts.activeClass),this.el.trigger("sortable:activate",b.el))};f.prototype.reset=function(a){this.accept&&(this.opts.activeClass&&this.el.removeClass(this.opts.activeClass),this.el.trigger("sortable:deactivate",b.el))};f.prototype.start=
function(a){if(this.opts.disabled)return!1;a.stopPropagation();a.preventDefault();if(this.opts.cancel)for(var d=c(a.target);d[0]!==this.el[0];){if(d.is(this.opts.cancel))return!1;d=d.parent()}if(this.opts.handle){for(var d=c(a.target),e=!1;d[0]!==this.el[0];){if(d.is(this.opts.handle)){e=!0;break}d=d.parent()}if(!e)return!1}b.start(this,c(a.currentTarget),a);c(document).on("mouseup touchend MSPointerUp pointerup",c.proxy(this.end,this));this.index=b.el.index();this.opts.forcePlaceholderSize&&(this.placeholder.height(b.el.height()),
this.placeholder.width(b.el.width()));this.el.trigger("dragging:start",{item:b.el})};f.prototype.enter=function(a,d,e){this.accept&&!this.opts.disabled&&(a.preventDefault(),a.stopPropagation(),d=a.currentTarget,e=d===this.el[0],d!==this.placeholder[0]&&(d=c(d),e&&!this.isEmpty&&this.placeholder.parent().length||(this.opts.forcePlaceholderSize&&this.placeholder.height(b.el.height()),this.placeholder.parent().length||(this.el.append(b.placeholder=this.placeholder.hide()),this.el.append(b.el)),e?this.el.append(this.placeholder):
(this.direction=this.placeholder.show().index()<d.index()?"down":"up",d["down"===this.direction?"after":"before"](this.placeholder),n(b.el[0],0,0),d=b.el[0].getBoundingClientRect(),b.origin.x=d.left-b.origin.offset.x,b.origin.y=d.top-b.origin.offset.y,n(b.el[0],a.pageX-b.origin.x,a.pageY-b.origin.y)),this.el.trigger("sortable:sort",{item:b.el}))))};f.prototype.end=function(a){a.stopPropagation();a.preventDefault();b.el&&(this.el.trigger("sortable:beforeStop",{item:b.el}),b.el.insertBefore(this.el.find(this.opts.items).get(this.index)),
c(document).off("mouseup touchend MSPointerUp pointerup",this.end),setTimeout(function(){b.stop();this.el.trigger("dragging:stop")}),this.index=null)};f.prototype.drop=function(a){this.accept&&!this.opts.disabled&&(a.stopPropagation(),a.preventDefault(),b.el&&(b.el.insertBefore(this.placeholder).show(),b.placeholder=null,a=b.el.index(),null===this.index?(this.el.trigger("sortable:receive",{item:b.el}),this.el.trigger("sortable:update",{item:b.el,index:a})):a!==this.index&&this.el.trigger("sortable:update",
{item:b.el,index:a}),this.el.trigger("sortable:change",{item:b.el}),this.el.trigger("sortable:beforeStop",{item:b.el}),b.parent instanceof f&&(b.parent.index=null,b.parent.el.trigger("dragging:stop")),c(document).off("mouseup touchend MSPointerUp pointerup",this.end),b.stop(!1),this.el.trigger("dragging:stop")))};f.prototype.toArray=function(a){a||(a={});var b=a.attribute||"id",e=[];this.el.find(this.opts.items).each(function(){e.push(c(this).prop(b))});return e};c.fn.draggable=p(e,"draggable",{cancel:"input, textarea, button, select, option",
connectWith:!1,cursor:"auto",disabled:!1,handle:!1,initialized:!1,scope:"default"});c.fn.droppable=p(l,"droppable",{accept:"*",activeClass:!1,disabled:!1,hoverClass:!1,initialized:!1,scope:"default"});c.fn.sortable=p(f,"sortable",{accept:"*",activeClass:!1,cancel:"input, textarea, button, select, option",connectWith:!1,disabled:!1,forcePlaceholderSize:!1,handle:!1,initialized:!1,items:"li, div",placeholder:"placeholder"})}(window.Zepto||window.jQuery);
